<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mobile Game Scaling Decision Calculator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.95;
        }

        .calculator-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 968px) {
            .calculator-grid {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: white;
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .card h2 {
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }

        .method-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
        }

        .method-btn {
            flex: 1;
            padding: 12px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .method-btn.active {
            background: #667eea;
            color: white;
        }

        .method-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            color: #555;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .input-group input, .input-group select {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .input-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .cohort-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .cohort-table th, .cohort-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        .cohort-table th {
            background: #f5f5f5;
            font-weight: 600;
            color: #555;
        }

        .cohort-table input {
            width: 100%;
            padding: 5px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
        }

        .add-cohort-btn {
            margin-top: 10px;
            padding: 8px 16px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
        }

        .calculate-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .calculate-btn:hover {
            transform: translateY(-2px);
        }

        .results-section {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .metric-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
        }

        .metric-card h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .metric-label {
            color: #777;
            font-size: 0.9rem;
        }

        .decision-box {
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: center;
        }

        .decision-scale {
            background: linear-gradient(135deg, #00b09b, #96c93d);
            color: white;
        }

        .decision-iterate {
            background: linear-gradient(135deg, #ffa726, #fb8c00);
            color: white;
        }

        .decision-shutdown {
            background: linear-gradient(135deg, #ef5350, #e53935);
            color: white;
        }

        .decision-title {
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .decision-subtitle {
            font-size: 1.1rem;
            opacity: 0.95;
        }

        .benchmark-indicator {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.85rem;
            margin-left: 10px;
            font-weight: 600;
        }

        .benchmark-good {
            background: #4caf50;
            color: white;
        }

        .benchmark-average {
            background: #ff9800;
            color: white;
        }

        .benchmark-poor {
            background: #f44336;
            color: white;
        }

        .insights-list {
            list-style: none;
            padding: 0;
            margin-top: 15px;
        }

        .insights-list li {
            padding: 10px;
            background: white;
            border-radius: 6px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
        }

        .insights-list li::before {
            content: "â†’";
            color: #667eea;
            font-weight: bold;
            margin-right: 10px;
        }

        .warning-box {
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }

        .warning-box h4 {
            color: #856404;
            margin-bottom: 8px;
        }

        .warning-box p {
            color: #856404;
            font-size: 0.95rem;
        }

        .tab-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab-btn {
            padding: 10px 20px;
            background: #f5f5f5;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .tab-btn.active {
            background: #667eea;
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .remove-cohort {
            background: #ff5252;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸŽ® Mobile Game Scaling Decision Calculator</h1>
            <p>Data-driven framework for profitable growth decisions</p>
        </div>

        <div class="calculator-grid">
            <!-- Input Section -->
            <div class="card">
                <h2>ðŸ“Š Input Data</h2>
                
                <div class="method-selector">
                    <button class="method-btn active" onclick="selectMethod('basic')">Basic Method</button>
                    <button class="method-btn" onclick="selectMethod('intermediate')">Intermediate</button>
                    <button class="method-btn" onclick="selectMethod('advanced')">Advanced</button>
                </div>

                <!-- Basic Method Inputs -->
                <div id="basic-inputs" class="method-inputs">
                    <div class="input-group">
                        <label>Game Genre</label>
                        <select id="genre">
                            <option value="hypercasual">Hyper-Casual</option>
                            <option value="casual">Casual</option>
                            <option value="midcore">Mid-Core</option>
                            <option value="socialcasino">Social Casino</option>
                        </select>
                    </div>
                    <div class="input-row">
                        <div class="input-group">
                            <label>Day 1 Retention (%)</label>
                            <input type="number" id="d1-retention" value="35" min="0" max="100" step="0.1">
                        </div>
                        <div class="input-group">
                            <label>Day 7 Retention (%)</label>
                            <input type="number" id="d7-retention" value="15" min="0" max="100" step="0.1">
                        </div>
                    </div>
                    <div class="input-row">
                        <div class="input-group">
                            <label>ARPDAU ($)</label>
                            <input type="number" id="arpdau" value="0.10" min="0" step="0.01">
                        </div>
                        <div class="input-group">
                            <label>Average CPI ($)</label>
                            <input type="number" id="avg-cpi" value="2.50" min="0" step="0.01">
                        </div>
                    </div>
                </div>

                <!-- Intermediate Method Inputs -->
                <div id="intermediate-inputs" class="method-inputs" style="display: none;">
                    <div class="input-group">
                        <label>Add Cohort Data</label>
                        <table class="cohort-table" id="cohort-table">
                            <thead>
                                <tr>
                                    <th>Source</th>
                                    <th>Users</th>
                                    <th>CPI ($)</th>
                                    <th>D1 (%)</th>
                                    <th>D1 ARPU ($)</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="cohort-tbody">
                                <tr>
                                    <td><input type="text" value="Facebook" class="cohort-source"></td>
                                    <td><input type="number" value="50000" class="cohort-users"></td>
                                    <td><input type="number" value="0.54" step="0.01" class="cohort-cpi"></td>
                                    <td><input type="number" value="21" step="0.1" class="cohort-d1"></td>
                                    <td><input type="number" value="0.17" step="0.01" class="cohort-d1-arpu"></td>
                                    <td><button class="remove-cohort" onclick="removeCohort(this)">Remove</button></td>
                                </tr>
                            </tbody>
                        </table>
                        <button class="add-cohort-btn" onclick="addCohort()">+ Add Cohort</button>
                    </div>
                    <div class="input-row">
                        <div class="input-group">
                            <label>Day 30 Retention (%)</label>
                            <input type="number" id="d30-retention-inter" value="5" min="0" max="100" step="0.1">
                        </div>
                        <div class="input-group">
                            <label>Target ROAS Day</label>
                            <input type="number" id="target-roas-day" value="90" min="1" step="1">
                        </div>
                    </div>
                </div>

                <!-- Advanced Method Inputs -->
                <div id="advanced-inputs" class="method-inputs" style="display: none;">
                    <div class="tab-buttons">
                        <button class="tab-btn active" onclick="switchTab('retention')">Retention</button>
                        <button class="tab-btn" onclick="switchTab('monetization')">Monetization</button>
                        <button class="tab-btn" onclick="switchTab('acquisition')">Acquisition</button>
                    </div>
                    
                    <div id="retention-tab" class="tab-content active">
                        <div class="input-row">
                            <div class="input-group">
                                <label>D1 Retention (%)</label>
                                <input type="number" id="adv-d1" value="35" min="0" max="100" step="0.1">
                            </div>
                            <div class="input-group">
                                <label>D3 Retention (%)</label>
                                <input type="number" id="adv-d3" value="25" min="0" max="100" step="0.1">
                            </div>
                        </div>
                        <div class="input-row">
                            <div class="input-group">
                                <label>D7 Retention (%)</label>
                                <input type="number" id="adv-d7" value="15" min="0" max="100" step="0.1">
                            </div>
                            <div class="input-group">
                                <label>D30 Retention (%)</label>
                                <input type="number" id="adv-d30" value="5" min="0" max="100" step="0.1">
                            </div>
                        </div>
                    </div>
                    
                    <div id="monetization-tab" class="tab-content">
                        <div class="input-row">
                            <div class="input-group">
                                <label>IAP ARPDAU ($)</label>
                                <input type="number" id="iap-arpdau" value="0.05" min="0" step="0.01">
                            </div>
                            <div class="input-group">
                                <label>Ad ARPDAU ($)</label>
                                <input type="number" id="ad-arpdau" value="0.05" min="0" step="0.01">
                            </div>
                        </div>
                        <div class="input-row">
                            <div class="input-group">
                                <label>Paying User % (IAP)</label>
                                <input type="number" id="paying-share" value="2" min="0" max="100" step="0.1">
                            </div>
                            <div class="input-group">
                                <label>ARPPU ($)</label>
                                <input type="number" id="arppu" value="25" min="0" step="0.1">
                            </div>
                        </div>
                    </div>
                    
                    <div id="acquisition-tab" class="tab-content">
                        <div class="input-row">
                            <div class="input-group">
                                <label>Total Ad Spend ($)</label>
                                <input type="number" id="total-spend" value="10000" min="0" step="1">
                            </div>
                            <div class="input-group">
                                <label>Total Installs</label>
                                <input type="number" id="total-installs" value="4000" min="1" step="1">
                            </div>
                        </div>
                        <div class="input-row">
                            <div class="input-group">
                                <label>Organic Multiplier (K-Factor)</label>
                                <input type="number" id="k-factor" value="0.3" min="0" max="10" step="0.01">
                            </div>
                            <div class="input-group">
                                <label>Target Market</label>
                                <select id="target-market">
                                    <option value="tier1">Tier 1 (US, UK, CA)</option>
                                    <option value="tier2">Tier 2 (EU, JP)</option>
                                    <option value="tier3">Tier 3 (SEA, LATAM)</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <button class="calculate-btn" onclick="calculateMetrics()">Calculate & Analyze</button>
            </div>

            <!-- Results Section -->
            <div class="card">
                <h2>ðŸ“ˆ Analysis Results</h2>
                <div id="results-container">
                    <div class="results-section">
                        <p style="text-align: center; color: #888;">Enter your data and click Calculate to see results</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Decision & Insights -->
        <div class="card" id="decision-card" style="display: none;">
            <h2>ðŸŽ¯ Strategic Decision & Insights</h2>
            <div id="decision-container"></div>
        </div>
    </div>

    <!-- Footer Attribution -->
    <div style="text-align: center; margin-top: 40px; padding: 20px; color: white;">
        <p style="font-size: 1.1rem; margin-bottom: 10px;">
            Built by <a href="https://reza-h.com" target="_blank" style="color: white; font-weight: bold;">REXA</a> with Claude.ai
        </p>
        <p style="font-size: 0.95rem; opacity: 0.9; margin-bottom: 10px;">
            Connect on LinkedIn: 
            <a href="https://www.linkedin.com/in/reza-h/" target="_blank" style="color: white; text-decoration: underline;">
                linkedin.com/in/reza-h
            </a>
        </p>
        <p style="font-size: 0.95rem; opacity: 0.9;">
            View on GitHub: 
            <a href="https://github.com/mohammadreza87/ltv-calculator" target="_blank" style="color: white; text-decoration: underline;">
                github.com/mohammadreza87/ltv-calculator
            </a>
        </p>
        <p style="font-size: 0.85rem; opacity: 0.8; margin-top: 15px;">
            ðŸ“Š Data-driven decisions for mobile game scaling
        </p>
    </div>

    <script>
        let currentMethod = 'basic';
        let cohortCounter = 1;

        function selectMethod(method) {
            currentMethod = method;
            document.querySelectorAll('.method-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.method-inputs').forEach(input => input.style.display = 'none');
            
            event.target.classList.add('active');
            document.getElementById(`${method}-inputs`).style.display = 'block';
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.style.display = 'none');
            
            event.target.classList.add('active');
            document.getElementById(`${tab}-tab`).style.display = 'block';
        }

        function addCohort() {
            const tbody = document.getElementById('cohort-tbody');
            const row = document.createElement('tr');
            row.innerHTML = `
                <td><input type="text" value="Source ${++cohortCounter}" class="cohort-source"></td>
                <td><input type="number" value="10000" class="cohort-users"></td>
                <td><input type="number" value="2.00" step="0.01" class="cohort-cpi"></td>
                <td><input type="number" value="30" step="0.1" class="cohort-d1"></td>
                <td><input type="number" value="0.15" step="0.01" class="cohort-d1-arpu"></td>
                <td><button class="remove-cohort" onclick="removeCohort(this)">Remove</button></td>
            `;
            tbody.appendChild(row);
        }

        function removeCohort(btn) {
            const tbody = document.getElementById('cohort-tbody');
            if (tbody.children.length > 1) {
                btn.parentElement.parentElement.remove();
            }
        }

        function calculateLTV(retention, arpdau, days = 180) {
            // Power law retention curve: R(t) = a * t^b
            // Using D1 and D7 to calculate parameters
            const d1 = retention.d1 / 100;
            const d7 = retention.d7 / 100;
            
            // Calculate power law parameters
            const b = Math.log(d7 / d1) / Math.log(7);
            const a = d1;
            
            // Calculate cumulative retention (area under curve)
            let cumulative = 0;
            for (let day = 1; day <= days; day++) {
                cumulative += a * Math.pow(day, b);
            }
            
            return arpdau * cumulative;
        }

        function getBenchmark(metric, value, genre = 'casual') {
            const benchmarks = {
                d1: { good: 35, average: 25, poor: 20 },
                d7: { good: 15, average: 10, poor: 5 },
                d30: { good: 5, average: 3, poor: 2 },
                ltv_cpi: { good: 3, average: 1.5, poor: 1 },
                roas_d7: { good: 30, average: 20, poor: 10 }
            };
            
            const bench = benchmarks[metric];
            if (!bench) return '';
            
            if (value >= bench.good) return 'benchmark-good';
            if (value >= bench.average) return 'benchmark-average';
            return 'benchmark-poor';
        }

        function getBenchmarkLabel(metric, value, genre = 'casual') {
            const benchmarkClass = getBenchmark(metric, value, genre);
            if (benchmarkClass === 'benchmark-good') return '<span class="benchmark-indicator benchmark-good">Above Target</span>';
            if (benchmarkClass === 'benchmark-average') return '<span class="benchmark-indicator benchmark-average">Average</span>';
            if (benchmarkClass === 'benchmark-poor') return '<span class="benchmark-indicator benchmark-poor">Below Target</span>';
            return '';
        }

        function calculateMetrics() {
            let results = {};
            let decision = '';
            let insights = [];

            if (currentMethod === 'basic') {
                // Basic calculations
                const d1 = parseFloat(document.getElementById('d1-retention').value);
                const d7 = parseFloat(document.getElementById('d7-retention').value);
                const arpdau = parseFloat(document.getElementById('arpdau').value);
                const cpi = parseFloat(document.getElementById('avg-cpi').value);
                const genre = document.getElementById('genre').value;
                
                // Calculate estimated LTV (simplified)
                const ltv = calculateLTV({ d1, d7 }, arpdau);
                const ltvCpiRatio = ltv / cpi;
                const d7Roas = (arpdau * 7 * (d7 / 100)) / cpi * 100;
                const roi = ((ltv - cpi) / cpi) * 100;
                
                results = {
                    ltv: ltv.toFixed(2),
                    ltvCpiRatio: ltvCpiRatio.toFixed(2),
                    d7Roas: d7Roas.toFixed(1),
                    roi: roi.toFixed(1),
                    d1,
                    d7,
                    paybackDays: Math.round(cpi / (arpdau * (d7 / 100)))
                };
                
                // Decision logic
                if (d1 < 30 || d7 < 10) {
                    decision = 'shutdown';
                    insights.push('Retention metrics are below minimum viability thresholds');
                    insights.push('Focus on improving core gameplay and FTUE before any scaling');
                } else if (ltvCpiRatio < 1) {
                    decision = 'shutdown';
                    insights.push('LTV:CPI ratio below 1 - losing money on every user');
                    insights.push('Need to either reduce CPI or improve monetization significantly');
                } else if (ltvCpiRatio < 1.5) {
                    decision = 'iterate';
                    insights.push('LTV:CPI ratio is marginal - needs improvement before scaling');
                    insights.push('Consider A/B testing monetization features');
                } else {
                    decision = 'scale';
                    insights.push('Strong unit economics - ready for controlled scaling');
                    insights.push(`Projected ${results.paybackDays}-day payback period`);
                }
            } else if (currentMethod === 'intermediate') {
                // Intermediate calculations with cohort data
                const cohorts = [];
                const rows = document.querySelectorAll('#cohort-tbody tr');
                let totalSpend = 0;
                let totalUsers = 0;
                let weightedD1 = 0;
                let weightedCPI = 0;
                let totalRevenue = 0;
                
                rows.forEach(row => {
                    const source = row.querySelector('.cohort-source').value;
                    const users = parseFloat(row.querySelector('.cohort-users').value);
                    const cpi = parseFloat(row.querySelector('.cohort-cpi').value);
                    const d1 = parseFloat(row.querySelector('.cohort-d1').value);
                    const d1Arpu = parseFloat(row.querySelector('.cohort-d1-arpu').value);
                    
                    const spend = users * cpi;
                    totalSpend += spend;
                    totalUsers += users;
                    weightedD1 += d1 * users;
                    weightedCPI += cpi * users;
                    totalRevenue += users * d1Arpu;
                    
                    cohorts.push({ source, users, cpi, d1, d1Arpu, spend, revenue: users * d1Arpu });
                });
                
                const d30 = parseFloat(document.getElementById('d30-retention-inter').value);
                const targetDay = parseFloat(document.getElementById('target-roas-day').value);
                
                const avgD1 = weightedD1 / totalUsers;
                const avgCPI = weightedCPI / totalUsers;
                const d1Roas = (totalRevenue / totalSpend) * 100;
                
                // Estimate LTV based on retention curve
                const estimatedLTV = (totalRevenue / totalUsers) * (targetDay / 7) * (d30 / avgD1);
                const projectedRoas = (estimatedLTV * totalUsers / totalSpend) * 100;
                
                results = {
                    totalSpend: totalSpend.toFixed(0),
                    totalUsers: totalUsers.toFixed(0),
                    avgCPI: avgCPI.toFixed(2),
                    avgD1: avgD1.toFixed(1),
                    d1Roas: d1Roas.toFixed(1),
                    projectedRoas: projectedRoas.toFixed(1),
                    estimatedLTV: estimatedLTV.toFixed(2),
                    cohorts: cohorts
                };
                
                // Cohort-specific insights
                cohorts.forEach(cohort => {
                    const cohortRoas = (cohort.revenue / cohort.spend) * 100;
                    if (cohortRoas > d1Roas * 1.2) {
                        insights.push(`${cohort.source} performing ${((cohortRoas / d1Roas - 1) * 100).toFixed(0)}% above average`);
                    } else if (cohortRoas < d1Roas * 0.8) {
                        insights.push(`${cohort.source} underperforming - consider reducing spend`);
                    }
                });
                
                if (projectedRoas < 100) {
                    decision = 'iterate';
                    insights.push(`Projected ${targetDay}-day ROAS below breakeven`);
                } else if (projectedRoas < 150) {
                    decision = 'iterate';
                    insights.push('Marginal profitability - optimize before scaling');
                } else {
                    decision = 'scale';
                    insights.push(`Strong ${targetDay}-day ROAS projection: ${projectedRoas.toFixed(0)}%`);
                }
            } else {
                // Advanced calculations
                const d1 = parseFloat(document.getElementById('adv-d1').value);
                const d3 = parseFloat(document.getElementById('adv-d3').value);
                const d7 = parseFloat(document.getElementById('adv-d7').value);
                const d30 = parseFloat(document.getElementById('adv-d30').value);
                
                const iapArpdau = parseFloat(document.getElementById('iap-arpdau').value);
                const adArpdau = parseFloat(document.getElementById('ad-arpdau').value);
                const blendedArpdau = iapArpdau + adArpdau;
                
                const payingShare = parseFloat(document.getElementById('paying-share').value);
                const arppu = parseFloat(document.getElementById('arppu').value);
                
                const totalSpend = parseFloat(document.getElementById('total-spend').value);
                const totalInstalls = parseFloat(document.getElementById('total-installs').value);
                const kFactor = parseFloat(document.getElementById('k-factor').value);
                const market = document.getElementById('target-market').value;
                
                // Calculate metrics
                const cpi = totalSpend / totalInstalls;
                const organicInstalls = totalInstalls * kFactor;
                const eCPI = totalSpend / (totalInstalls + organicInstalls);
                
                // Advanced LTV calculation using power law
                const retentionData = [
                    { day: 1, rate: d1 / 100 },
                    { day: 3, rate: d3 / 100 },
                    { day: 7, rate: d7 / 100 },
                    { day: 30, rate: d30 / 100 }
                ];
                
                // Fit power law curve
                const sumX = retentionData.reduce((sum, d) => sum + Math.log(d.day), 0);
                const sumY = retentionData.reduce((sum, d) => sum + Math.log(d.rate), 0);
                const sumXY = retentionData.reduce((sum, d) => sum + Math.log(d.day) * Math.log(d.rate), 0);
                const sumX2 = retentionData.reduce((sum, d) => sum + Math.log(d.day) ** 2, 0);
                const n = retentionData.length;
                
                const b = (n * sumXY - sumX * sumY) / (n * sumX2 - sumX ** 2);
                const logA = (sumY - b * sumX) / n;
                const a = Math.exp(logA);
                
                // Calculate LTV for different periods
                const ltv90 = calculateAdvancedLTV(a, b, blendedArpdau, 90);
                const ltv180 = calculateAdvancedLTV(a, b, blendedArpdau, 180);
                const ltv365 = calculateAdvancedLTV(a, b, blendedArpdau, 365);
                
                // Calculate ROAS projections
                const d7Revenue = blendedArpdau * 7 * (d7 / 100);
                const d30Revenue = blendedArpdau * 30 * (d30 / 100);
                const d7Roas = (d7Revenue / eCPI) * 100;
                const d30Roas = (d30Revenue / eCPI) * 100;
                
                results = {
                    cpi: cpi.toFixed(2),
                    eCPI: eCPI.toFixed(2),
                    organicUplift: (kFactor * 100).toFixed(0),
                    ltv90: ltv90.toFixed(2),
                    ltv180: ltv180.toFixed(2),
                    ltv365: ltv365.toFixed(2),
                    ltvCpiRatio180: (ltv180 / eCPI).toFixed(2),
                    d7Roas: d7Roas.toFixed(1),
                    d30Roas: d30Roas.toFixed(1),
                    paybackDays: Math.round(eCPI / blendedArpdau),
                    blendedArpdau: blendedArpdau.toFixed(3),
                    monetizationMix: {
                        iap: ((iapArpdau / blendedArpdau) * 100).toFixed(0),
                        ads: ((adArpdau / blendedArpdau) * 100).toFixed(0)
                    },
                    retentionHealth: getRetentionHealth(d1, d7, d30),
                    projectedMonthlyRevenue: (ltv180 * totalInstalls * 6 / 180).toFixed(0)
                };
                
                // Advanced decision logic
                if (d1 < 30 || d7 < 12 || d30 < 3) {
                    decision = 'shutdown';
                    insights.push('Critical retention issues detected - product needs major overhaul');
                } else if (results.ltvCpiRatio180 < 1.5) {
                    decision = 'iterate';
                    insights.push('LTV:CPI ratio below healthy threshold (1.5x)');
                    insights.push('Focus on retention improvements and monetization optimization');
                } else if (results.ltvCpiRatio180 < 3) {
                    decision = 'scale';
                    insights.push('Metrics support controlled scaling with close monitoring');
                    insights.push(`Target 3:1 LTV:CPI ratio for aggressive scaling`);
                } else {
                    decision = 'scale';
                    insights.push('Excellent unit economics - ready for aggressive scaling');
                    insights.push(`Strong ${results.ltvCpiRatio180}x LTV:CPI ratio indicates high profitability`);
                }
                
                // Market-specific insights
                if (market === 'tier1') {
                    insights.push('Tier 1 markets: Higher CPIs but stronger monetization potential');
                } else if (market === 'tier2') {
                    insights.push('Tier 2 markets: Balanced CPI and monetization');
                } else {
                    insights.push('Tier 3 markets: Lower CPIs but requires volume for profitability');
                }
            }
            
            displayResults(results, decision, insights);
        }

        function calculateAdvancedLTV(a, b, arpdau, days) {
            let cumulative = 0;
            for (let day = 1; day <= days; day++) {
                cumulative += a * Math.pow(day, b);
            }
            return arpdau * cumulative;
        }

        function getRetentionHealth(d1, d7, d30) {
            const score = (d1 / 40) * 0.4 + (d7 / 20) * 0.3 + (d30 / 10) * 0.3;
            if (score > 0.8) return 'Excellent';
            if (score > 0.6) return 'Good';
            if (score > 0.4) return 'Average';
            return 'Poor';
        }

        function displayResults(results, decision, insights) {
            const resultsContainer = document.getElementById('results-container');
            const decisionCard = document.getElementById('decision-card');
            const decisionContainer = document.getElementById('decision-container');
            
            let resultsHTML = '<div class="results-section">';
            
            if (currentMethod === 'basic') {
                resultsHTML += `
                    <div class="metric-card">
                        <h3>Lifetime Value (LTV)</h3>
                        <div class="metric-value">${results.ltv}</div>
                        <div class="metric-label">Estimated 180-day LTV</div>
                    </div>
                    <div class="metric-card">
                        <h3>LTV:CPI Ratio</h3>
                        <div class="metric-value">${results.ltvCpiRatio}x ${getBenchmarkLabel('ltv_cpi', results.ltvCpiRatio)}</div>
                        <div class="metric-label">Target: 3x for healthy margins</div>
                    </div>
                    <div class="metric-card">
                        <h3>Day 7 ROAS</h3>
                        <div class="metric-value">${results.d7Roas}% ${getBenchmarkLabel('roas_d7', results.d7Roas)}</div>
                        <div class="metric-label">Revenue returned by Day 7</div>
                    </div>
                    <div class="metric-card">
                        <h3>ROI Projection</h3>
                        <div class="metric-value">${results.roi}%</div>
                        <div class="metric-label">Expected return on investment</div>
                    </div>
                `;
            } else if (currentMethod === 'intermediate') {
                resultsHTML += `
                    <div class="metric-card">
                        <h3>Total Investment</h3>
                        <div class="metric-value">${parseInt(results.totalSpend).toLocaleString()}</div>
                        <div class="metric-label">${results.totalUsers} users acquired</div>
                    </div>
                    <div class="metric-card">
                        <h3>Blended CPI</h3>
                        <div class="metric-value">${results.avgCPI}</div>
                        <div class="metric-label">Average across all sources</div>
                    </div>
                    <div class="metric-card">
                        <h3>Day 1 ROAS</h3>
                        <div class="metric-value">${results.d1Roas}%</div>
                        <div class="metric-label">Immediate return signal</div>
                    </div>
                    <div class="metric-card">
                        <h3>Projected ROAS</h3>
                        <div class="metric-value">${results.projectedRoas}%</div>
                        <div class="metric-label">Expected by target day</div>
                    </div>
                `;
            } else {
                resultsHTML += `
                    <div class="metric-card">
                        <h3>Effective CPI</h3>
                        <div class="metric-value">${results.eCPI}</div>
                        <div class="metric-label">Including ${results.organicUplift}% organic uplift</div>
                    </div>
                    <div class="metric-card">
                        <h3>LTV Projections</h3>
                        <div class="metric-value">${results.ltv180}</div>
                        <div class="metric-label">D90: ${results.ltv90} | D365: ${results.ltv365}</div>
                    </div>
                    <div class="metric-card">
                        <h3>LTV:CPI Ratio (D180)</h3>
                        <div class="metric-value">${results.ltvCpiRatio180}x</div>
                        <div class="metric-label">Profitability multiplier</div>
                    </div>
                    <div class="metric-card">
                        <h3>ROAS Progression</h3>
                        <div class="metric-value">${results.d30Roas}%</div>
                        <div class="metric-label">D7: ${results.d7Roas}% | D30: ${results.d30Roas}%</div>
                    </div>
                    <div class="metric-card">
                        <h3>Monetization Mix</h3>
                        <div class="metric-value">${results.monetizationMix.iap}% / ${results.monetizationMix.ads}%</div>
                        <div class="metric-label">IAP / Ads revenue split</div>
                    </div>
                    <div class="metric-card">
                        <h3>Retention Health</h3>
                        <div class="metric-value">${results.retentionHealth}</div>
                        <div class="metric-label">Overall engagement score</div>
                    </div>
                `;
            }
            
            resultsHTML += '</div>';
            resultsContainer.innerHTML = resultsHTML;
            
            // Display decision
            let decisionHTML = '';
            if (decision === 'scale') {
                decisionHTML = `
                    <div class="decision-box decision-scale">
                        <div class="decision-title">âœ… SCALE</div>
                        <div class="decision-subtitle">Game is ready for growth investment</div>
                    </div>
                `;
            } else if (decision === 'iterate') {
                decisionHTML = `
                    <div class="decision-box decision-iterate">
                        <div class="decision-title">ðŸ”„ ITERATE</div>
                        <div class="decision-subtitle">Improve metrics before scaling</div>
                    </div>
                `;
            } else {
                decisionHTML = `
                    <div class="decision-box decision-shutdown">
                        <div class="decision-title">â›” PIVOT/SHUTDOWN</div>
                        <div class="decision-subtitle">Fundamental issues need addressing</div>
                    </div>
                `;
            }
            
            decisionHTML += '<ul class="insights-list">';
            insights.forEach(insight => {
                decisionHTML += `<li>${insight}</li>`;
            });
            decisionHTML += '</ul>';
            
            // Add phase-specific recommendations
            if (currentMethod === 'advanced') {
                decisionHTML += `
                    <div class="warning-box">
                        <h4>ðŸ“‹ Next Steps</h4>
                        <p>
                `;
                
                if (decision === 'scale') {
                    decisionHTML += 'Start with 20% budget increase weekly, monitor cohort performance closely. Focus on creative optimization to reduce CPI.';
                } else if (decision === 'iterate') {
                    decisionHTML += 'Run A/B tests on monetization, improve D1 retention by 5%, then re-evaluate. Consider soft launching in additional markets for more data.';
                } else {
                    decisionHTML += 'Conduct user research to identify core issues. Consider pivoting game mechanics or targeting a different audience segment.';
                }
                
                decisionHTML += '</p></div>';
            }
            
            decisionContainer.innerHTML = decisionHTML;
            decisionCard.style.display = 'block';
        }
    </script>
</body>
</html>